openstack：
	它是NASA和其它公司共同研发的开源软件
	openstack是用python(digone)写的
	openstack用于解决多台服务器上的多台虚拟机的管理（openstack服务器上也可以有多台虚拟机）
	openstack就是基于Iaas云而设计的解决方案
	现在openstack是红帽的，红帽是IBM的，openstack不是开源的吗，华为提交的代码量是最多的	
	但是openstack兼容不是很好，就比如说我们上一个版本的命令下一个版本可能就不好用了，我们用的版本是p版本的，它的版本是26个英文字母，现在更新到queen版本
	
************************************************************************************************************************************************************************

	构建一个云：
		最底层是多台服务器上的多个虚拟机
		一台openstack管理机，管理这些虚拟机
		云是把opentack管理的这些虚拟机提供给其它公司使用
	什么是云计算：
		云其实是一个服务，便捷的交付模式，也就是方便充值，这种模式提供可用的，便捷的，按需的网络访问，进入可配置的计算资源共享池
		这些资源能够被快速提供，只需要投入很少的管理工作，或与服务供应商进行很少的交互
		通常涉及通过互联网来提供动态易于扩展且经常是虚拟化的资源
	云分为三个种类：
		1.Iaas云：
			基础设施服务！为用户提供虚拟的服务器（什么cpu、内存、存储、网络和其它基本的计算资源）用户可以在这个虚拟服务器上运行所有的软件，
			包括操作系统和应用程序。我们通常说的阿里云和华为云都是Iaas云
			Iass云又分为三个种类：公有云（你买别人的云主机）、私有云（你自己搭）、混合云（自己搭完不够用，还买别人的）
		2.pass云：
			即平台服务！就好比说淘宝，众多的商家和平台共同组成了pass云，
			平台的开发商为平台提供专用的服务，针对该平台进行的应用系统开发、优化等服务，也可以把pass云比做云计算中的中间件
			它是已经开发好的，用户直接就可以用这个平台，而不是说给你原始的虚拟服务器
			众多的功能、商家和淘宝平台一起组成了pass云
		3.SaaS云：
			即软件服务！就好比应用宝，这样的软件市场，客户想用这个软件，直接下载，这个软件的维护和更新全都是厂商来负责的，客户就是用它的功能就可以了
			用户只需要支付相应的使用费用即可
			成千上万的软件开发商，把它们的软件上架到安卓市场上，我们客户浏览的这个软件市场，就是SaaS云
			它能极大的杜绝盗版的情况！

*************************************************************************************************************************************************************************	

openstack的7大组件
	正因为这个软件太大了，所以维护起来很麻烦，绝对不是一个人就能维护的
	1.Horizon：
		它就是一个web页面，是用apche实现的，也就是LA(apache)MP(python),用于管理各种openstack服务的，我们通过图形界面实现创建用户、管理网络、启动实例等操作
		有了这个组件，用户就可以通过这个网页的图形界面管理云主机！
	2.keystone:
		在它这里认证的用户，在openstack服务器管理的虚拟机上都有效！
		一台openstack服务器，可以在这台服务器里创建多台虚拟机，这些虚拟机称之为云主机
		那你想与华为云上的这些云主机交互，必然需要密码的，这个密码就是openstack服务器上的这个组件提供的
		为其它服务提供认证和授权的集中身份管理服务
		也提供了集中的目录服务
		支持多种身份认证模式，如密码认证，令牌认证，以及AWS（亚马逊web服务）
		为用户和其它服务提供了SSO认证服务
	3.Neutron：这个组件的使用方法也是在web页面里使用，它是一种软件定义网络服务！
		我们在组建云的时候，最大的困难就是网络,因为一家公司购买的华为云主机，其实是openstack服务器所管理的众多服务器里的虚拟机！
		而这多台虚拟机可能会卖给多家公司使用，那么多家公司的云主机可能在一台服务器上，不可以让这些虚拟机数据互通，否则公司的数据不就泄露了吗
		所以就需要组建复杂的网络，把这么多的虚拟机分别放到不同的vlan里面，但是普通的vlan只能划分4096个，所以用了更宽的vxlan技术进行虚拟局域网的划分
		但是一家公司肯定要买多台云主机的，这么多台云主机不可能都在一台服务器上面吧，那么就需要复杂的trunk技术，把不同的服务器里的虚拟机连到一起！
		neutron这个组件，就是把这些复杂的网络架构封装到底层，把每个公司的多台云主机划分到一个虚拟局域网里！不让用户看到！
		然后买云主机的公司，就可以在这个虚拟的居域网里，自己创建虚拟路由，虚拟交换器，VPN，浮动VIP地址 等来构筑自己想搭建的网络了！
		这也是为什么使用openstack一定要卸载virsh-manger，因为你用virsh-manger这个图形管理工具，不就能看到整台服务器上的所有虚拟机了吗，那各家公司的服务器不就乱套了吗
		它openstack就是为了解决这种状况而设计的！openstack就是云主机的web网页图形管理工具！
		每一台受控于openstack管理机的服务器都要装这个软件，否则无法联网！
	4.Cinder：
		为虚拟机提供存储的服务
		为运行在Nova组件中的云主机提供永久的块存储
		可以通过快照进行数据备份
		经常应用在实例存储环境中，比如你要部署数据库，就要用到它
	5.Nova：
		Nova可以与keystone交互，然后识别keystone上的认证用户，Nova它能管理子服务器上的KVM！
		这个组件需要与keystron交互，openstack管理机管理的这些子服务器，在它们上面安装nova这个软件，这样管理机就能管理这些机器了
		你就比如说，我跟openstack这个管理机说，我要创建一台虚拟机，然后这个管理机去通知到下面的子服务器让它们的KVM执行创建虚拟机的动作，
		而执行创建动作的这个程序就是Nova，所以每一台子服务器上都要部署Nova，管理机也必须装Nova
		生产环境中，openstack这台管理机上面不安装KVM，它只是负责管理别的服务器！管理机这7个组件它都要，有的组件在教学环境中没用上，所以没装		
	6.Glance：
		比如我们要创建一个虚拟机的时候，不是需要后端盘吗！
		我们就可以把后端盘放到glance里，glance是一个网络服务，以后你想创建虚拟机就可以访问这个glance服务来获取后端盘数据
		这个组件你可以装在openstack管理机上，这样子服务器就可以通过找管理机来获得后端盘，也可以把它放在别的服务器上，方便管理
	7.swift：
		对象存储！提供给云主机使用
		分布式存储！
		提供复杂的存储，当你要把一台云主机的数据迁移到另一台云主机上，就会用到这个组件，这个组件用的就是ceph存储

*************************************************************************************************************************************************************************

openstack的脚本安装方式：
	这个openstack软件安装起来相当麻烦，所以我们用它自带的声明文件安装它，它完整的安装部署说明书，需要好几百页word文档
	openstack非常需要内存！所以至少要达到以下要求
	安装要求：
		创建两台新的虚拟机4.5和4.6 
	全新虚拟机的配置要求：
		4.5(node1)上既要装openstack又要装nova  因为它既要管理虚拟机，自己又能操控自己
			4.5 要2个CPU  10G内存 50G硬盘 2个网卡eth0 eth1（一个连vbr192.168.4.1 一个连virbr0 192.168.122.1）
		4.6(node2)只装nova
			4.6 要2个CPU  4.5G内存 50G硬盘 2个网卡eth0 eth1（一个连vbr192.168.4.1 一个连virbr0 192.168.122.1）
		虚拟机的创建方式去看第一天的！！！去用虚拟机管理命令(virsh edit node1)修改相应的xml文件
			改一下内存，改一下网卡:
			在xml配置文件中网卡的修改方式：要几张网卡，就有几段这个信息
		    <interface type='bridge'>
		      <mac address='52:54:00:b3:3f:c4'/>	#网卡mac信息需要删除
		      <source bridge='vbr'/>	#让另一张网卡连virbr0
		      <model type='virtio'/>
		      <address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/>	#这一行也要删除，这是指定插在哪个主板槽的意思
		    </interface>

		并为它们做磁盘分区扩容！！！！全新的虚拟机应该做什么看第一天的！！！！！
			
		做openstack的虚拟机，它的ip地址必须是静态的，所以，要把它的网卡改成静态的，方法看前一天的文档，别忘了重启网卡，做完之后两台虚拟机ping一下
			
		为它们配置主机名/etc/host
		指定DNS服务器/etc/reslov.conf
			/etc/reslov.conf文件里不能留search那一行,指定真机为DNS解析服务器
			真机搭建DNS服务器，搭建方式可以看之前的文档
			企业里如果需要我们自己搭建DNS服务器，千万不要把DNS和OPENSTACK装一台服务器上！
			如果你虚拟机能连外网，DNS就指定外网的DNS
		
		配置yum源
		要想安装部署openstack需要的yum源要三张光盘提供：
			CentOS7-1708.iso 	RHEL7-extras.iso 	RHEL7OSP-10.iso
		把这3张光盘挂载，然后做为yum源：	可以把虚拟机guestmount挂载到真机里部署，真机把这些光盘挂载ftp里！别挂载到root里，不然虚拟机没法访问
			这3张光盘我这么挂载的
			/root/openstack/CentOS7-1708.iso  /root/open/1 iso9660 defaults 0 0
			/root/openstack/RHEL7-extras.iso  /root/open/2 iso9660 defaults 0 0
			/root/openstack/RHEL7OSP-10.iso  /root/open/3 iso9660 defaults 0 0
			yum源的配置我要写12个yum源
			baseurl分别指定CentOS7-1708.iso、RHEL7-extras.iso这两张光盘的挂载点目录为源，也就是1和2
			而第三张光盘RHEL7OSP-10.iso的baseurl就要指定10个这样的目录rhel-7-server-openstack-10-tools-rpms为源才可以....
		
		现在我们还需要NTP服务器，让虚拟机和真机同步，真机和网络的时间同步，具体的配置方法看之前的文档

		openstack要关防火墙和selinux，卸载virsh-mannger虚拟化图形管理工具，因为这些功能openstack都有，不然它们之间会冲突
		全新的虚拟机的部署需求去看前一天的文档

	有了这两台虚拟机之后，我们开始安装openstack和nova
	安装步骤，先安装openstack管理机：
	1.配置卷组，生产环境中，openstack是真实服务器，所以要给它配置卷组
	2.安装openstack期间，系统会要求密钥验证，密钥验证可以保证我们从网络中获得的数据的完整性，以及确认没有被黑客篡改过数据
		在生产环境中我们可能用的是公共yum源，所以密钥这一步是必要的，
		教学环境中，不用导入，不过生产环境中就必须要做这一步了
	3.先安装openstack所要使用的KVM：
		yum -y install	qemu-kvm(硬件仿真层)、
					libvirt-daemon(libvirtd守护进程，我们与它交互来操作虚拟机)、
					libvirt-client(提供客户端管理命令)、
					libvirt-daemon-driver-qemu(驱动程序)
	4.安装python的工具包，因为openstack是用python写的：
		yum -y install python-setuptools
	5.安装packstack，也就是openstack的软件包
		yum -y install openstack-packstack
	6.创建应答文件：
		packstack --gen-answer-file=answer.ini 	#这个名字可以随便起，但是别忘了，你当前在哪个目录下，这个文件就在哪
	7.修改这个应答文件，利用这个应答文件来安装openstack的所有组件：
		vim answer.ini
		42 	CONFIG_SWIFT_INSTALL=y				#是否使用对象存储swift，如果我们没有对象存储，y就改成n
		75 	CONFIG_NTP_SERVERS=				#这里是指定我们云主机是和哪台时间服务器同步的，这里我们应该写真机的ip
		330 	CONFIG_KEYSTONE_ADMIN_USERNAME=admin		#这个是我们装完openstack之后，管理员的用户名
		333 	CONFIG_KEYSTONE_ADMIN_PW=admin			#这个是我们装完openstack之后，管理员的密码
		554 	CONFIG_CINDER_VOLUMES_CREATE=y			#这个是说是否自动配置卷组，如果改成n就需要手动配置卷组了，我们可以开着，让它自己配置卷组 
		840 	CONFIG_NEUTRON_ML2_TYPE_DRIVERS=vxlan,flat	#这个是Neutron组件的配置，默认只有vxlan这种虚拟局域网络，还要写flat才能支持连接运营商网络
		876 	CONFIG_NEUTRON_ML2_VXLAN_GROUP=239.1.1.5		
				#vxlan有很多，它们需要一个组播地址，在网络阶段我们接触过组播地址！
				#当我们全国访问虎牙TV这个软件的时候，我们好几十万人访问一个直播间的时候，它不可能识别这么多人的ip地址和mac地址吧！
				#所以，我们访问的时候，用的其实是这个软件给我们封装好的组播地址（包括ip的封装和mac地址的封装）！
				#当我们访问这个软件的时候，用的是这个软件给我提供的组播地址，来访问直播间获取数据的
				#这样极大的提高了处理数据的能力！它直播间这个网络不需要挨个去识别用户的ip地址和mac地址
				#这里组播地址也是一个原理，这么多虚拟机需要访问外网，那么给它们一个组播地址，外网的路由器识别这些虚拟机就相当方便了！！
		910 	CONFIG_NEUTRON_OVS_BRIDGE_MAPPINGS=physnet1:br-ex		
				#这里是指定openstack这台管理机能上网的物理网卡，与哪个虚拟交换机做绑定
				#这个虚拟交换机是用来解决复杂vlan划分与trunk数据互通的
				#这里定义的就是物理交换机名称！名称随便起，不过下面要用这个名称
		921 	CONFIG_NEUTRON_OVS_BRIDGE_IFACES=br-ex:eth0
				#这个是告诉openstack管理机，想上网，用哪块网卡连交换机！
		936 	CONFIG_NEUTRON_OVS_TUNNEL_IF=eth1		
				#之前的eth0用于外网通讯了，那现在还需要一张网卡，来连接openstack管理机与它管理的服务器上的虚拟机共同组成的虚拟局域网！
		1179 	CONFIG_PROVISION_DEMO=y
				#是否需要测试openstack能否正常运行，我们可以把它改成n，不然可能要测试半天
		保存退出
	8.启动这个应答文件：一键部署openstack
		需要注意的是，它的部署大概要20-40多分钟，这之间千万不能ctrl+c结束它！如果报错，根据它的报错去做相应的修改，再执行一遍命令！
		没有特殊的颜色提示，它就OK了
		packstack --answer-file=answer.ini 

*************************************************************************************************************************************************************************

openstack的网络配置：
	openstack管理机：
		管理机它要想上网
			它得有一张物理网卡能够连接真实的三层物理交换机（与三层交换机内网的端口ip同一个网段），这张网卡我们叫它eth0，它连上三层交换机之后，它就能上网了！
		而管理机所操控的多台服务器里的虚拟机也就是云主机，它们要是想上网
			要连接openstack里的一张网卡，才能实现数据互通与访问外网，openstack里的这张网卡就叫做eth1
	`	但是现在openstack管理机还需要一个软件来划分复杂的vlan与trrunk，这个软件（Neutron）提供了这个功能，它会做一个虚拟交换机来解决这些问题，
		但是这个虚拟交换机比普通的虚拟环境里的桥接网卡交换机的工作原理要复杂
		我们给这个虚拟交换机（VOS网桥）起了个名字叫br-ex，不过这个虚拟交换机没有IP，必须要与能连外网的网卡（eth0）绑定，使用eth0的网卡才能访问外网。
		这个虚拟交换机br-ex与eth0绑定以后，就会把eth0的IP抢过来，eth0就变成br-ex的端口了

		默认我们改完上面的配置文件之后，所有的网络配置都是ok的，但是也会有意外，可能需要我们手动改配置
		br-ex的配置文件也在/etc/sysconfig/network-scripts/ifcfg-br-ex
		vim /etc/sysconfig/network-scripts/ifcfg-br-ex
			ONBOOT="yes"	#开机自动启动
			NM_CONTROLLED="no" 
			IPADDR="192.168.1.1"
			PREFIX=24
			GATEWAY=192.168.1.254	#这3行是完整的把eth0的网卡信息移动过来了
			DEVICE=br-ex		#这是指定驱动名称
			NAME=br-ex			#这是它的名称
			DEVICETYPE=ovs		#这是它的驱动类型
			OVSBOOTPROTO="static"	#它是静态的IP，不会被dhcp干预
			TYPE=OVSBridge		#它变成网桥了，也就是交换机
		eth0网卡的配置信息vim /etc/sysconfig/network-scripts/ifcfg-eth0 
			DEVICE=eth0
			NAME=eth0	
			DEVICETYPE=ovs		#驱动类型
			TYPE=OVSPort		#变成vos网桥的端口了
			OVS_BRIDGE=br-ex		#是哪台ovs网桥的端口：br-ex
			ONBOOT=yes
			BOOTPROTO=none		#除了dhcp和static的第三种情况，端口转发

		查看ovs网桥的命令：ovs-vsctrl show

*************************************************************************************************************************************************************************

Horizon组件的配置：
	Horizon是一个用于管理控制openstack的web控制面板，也称为Dashboard仪表盘，可以管理实例，镜像，创建密钥对，对实例添加卷组，操作对象存储等。
	除此之外，用户还可以在控制面板中使用终端（console），或VNC直接访问实例，
	这个组件是基于python的django web框架开发的

	在我们安装完openstack之后，默认是无法用apache打开openstack管理网页的，我们还需要对apache中的openstack网页修改其配置文件
		vim /etc/httpd/conf.d/15-horizon_vhost.conf
		在WSGIProcessGroup apache这行下面写一行WSGIApplicationGroup %{GLOBAL}
		然后重启下apache服务：systemctl restart httpd

*************************************************************************************************************************************************************************

	上述配置完成，直接在真机浏览器中输入openstack虚拟机的ip即可访问openstack管理页面
		输入帐号和密码即可，以后做云主机都是在web页面里做

*************************************************************************************************************************************************************************

openstack的操作方式：
	有两种办法，一种是点鼠标，一种是用命令（如果去机房巡检可能要用命令），而且它命令每个版本都不一定都一样，所以建议用图形化管理
	命令操作方式：
		keystonerc_admin这个文件里有登陆openstack所需要的管理员用户名和密码，如果以后你的密码改了，也要来改这个文件才可以用这个文件登陆进控制命令行
		在openstack服务器上的linux命令行中，输入source keystonerc_admin (这个文件默认在root家目录里)，进入管理模式
		openstack user list ：显示所有用户
		openstack help：可以查看所有相关命令及帮助
		openstack help user：查看user相关的命令及帮助
	图形化（web页面上）操作方式：
		如果你安装完的openstack是英文版的，可以在用户管理那点设置修改
		比如有一个公司过来了，它们要买云主机：
			身份管理—>项目—>创建项目
		

************************************************************************************************************************************************************************

基本概念：
	项目管理：
		一个公司就是一个项目，比如你一个公司说要100台云主机，那你公司要的硬件配置总数告诉我，我把你要的一堆东西都给添加进你项目里
		一组隔离的资源和对象。由一组关联的用户进行管理
		根据配置的需求，项目对应一个组织，一个公司或是一个使用客户等
		项目中可以有多个用户，项目中的用户可以在该项目创建、管理虚拟资源
		具有admin角色的用户可以创建项目
		项目相关信息保存在MariaDB中
		packstack安装的openstack中默认有两个项目，是不能碰的，一个叫admin（为admin管理员创建的项目），一个是servcie（管理组件服务的）！


************************************************************************************************************************************************************************

知识点补充：在linux命令行里输入systemctl list-unit-files 可以查看当前系统里的所有服务
	其中：
		openstack-neutron-l3-agent.service 是与网络路由相关的服务
		openstack-nova-computer.service 是虚拟机相关的服务
		openstack-nova-console.service 是web管理界面的服务
		openstack-nova-consoleauth.service 是console认证的服务
		openstack-nova-novncproxy.service 我从web要登陆主机所要使用的服务


